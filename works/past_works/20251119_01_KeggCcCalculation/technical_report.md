# 技术报告：KEGG前100个化合物在pH=9下的生成自由能计算

## 1. 任务目标

本项目旨在响应用户请求，批量计算KEGG数据库中前100个化合物（ID从`C00001`到`C00100`）在非标准条件（pH=9）下的标准生成吉布斯自由能（ΔG'f）。

## 2. 实现方法与过程

### 2.1. 核心工具与参数

- **核心计算引擎**: `equilibrator-api`，一个强大的生化反应热力学计算库。
- **预测方法**: 组件贡献法 (Component Contribution, CC)，适用于数据库内已知的大部分化合物。
- **计算参数**:
  - **pH**: 9.0 (用户指定)
  - **pMg**: 3.0 (默认值)
  - **离子强度 (I)**: 0.25 M (默认值)
  - **温度 (T)**: 298.15 K (默认值)

### 2.2. 执行流程

1.  **初始化**: 在`works`目录下创建了`20251119_01_KeggCcCalculation`作为本次任务的工作区。
2.  **技术选型与迭代**:
    - 最初尝试创建并执行Jupyter Notebook (`.ipynb`)。但由于直接生成复杂的JSON结构时，字符串转义处理不当，导致`nbformat.reader.NotJSONError`，此路不通。
    - **切换策略**：为了保证任务的稳定执行，放弃了Jupyter Notebook，转而创建一个纯Python脚本 (`calculate_dg.py`)。这被证明是更稳定、更可靠的途径。
3.  **编码与调试**:
    - 编写了`calculate_dg.py`脚本，其中包含初始化`equilibrator-api`、生成化合物ID、循环计算和保存结果的逻辑。
    - **首次执行**：脚本成功运行，但所有计算均失败，报错为`'numpy.float64' object has no attribute 'value'`。
    - **问题分析与修复**：通过分析发现，`equilibrator-api`的`standard_dg_formation`函数对某些基础化合物（如水）会直接返回一个`float`数值，而不是带有`.value`属性的`pint`对象。因此，在脚本中加入了类型检查和处理逻辑，使其能兼容两种不同的返回值。
4.  **最终执行**: 修正后的脚本成功执行，完成了所有化合物的计算，并将结果存入CSV文件。

## 3. 结果与分析

计算结果已完整保存在以下文件中：
- **文件路径**: `works/20251119_01_KeggCcCalculation/kegg_cc_ph9_results.csv`

对100个化合物的计算结果统计如下：

- **计算成功**: **79** 个
- **计算失败**: **21** 个
  - **原因分析**:
    - **数据库未找到 (Not Found)**: 2个化合物 (如 `C00056`, `C00057`) 在 `equilibrator` 的数据库中没有对应条目。
    - **计算返回None (Calculation Returned None)**: 19个化合物的计算返回了`None`值，表明在pH=9的条件下无法通过组件贡献法得到其生成能。这可能是由于质子化状态或转化过程的复杂性导致。

## 4. 结论

本次任务成功完成了对KEGG前100个化合物在pH=9条件下的生成自由能批量计算。尽管遇到了开发过程中的一些技术挑战（如 Notebook 生成失败、API 返回值类型不一致），但通过快速调整策略和代码调试，最终达成了核心目标，并将一份结构化的数据产出交付。
